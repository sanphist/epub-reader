
&lt;!DOCTYPE html&gt;
&lt;html lang="zh"&gt;
&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;title&gt;å®Œæ•´ç‰ˆ EPUB é«˜äº®è¯è¡¨é˜…è¯»å™¨ï¼ˆä¿®æ­£ç‰ˆï¼‰&lt;/title&gt;
  &lt;meta name="viewport" content="width=device-width,initial-scale=1"&gt;
  &lt;script src="https://cdn.jsdelivr.net/npm/jszip/dist/jszip.min.js"&gt;&lt;/script&gt;
  &lt;script src="https://cdn.jsdelivr.net/npm/epubjs/dist/epub.min.js"&gt;&lt;/script&gt;
  &lt;script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"&gt;&lt;/script&gt;
  &lt;style&gt;
    html,body{margin:0;padding:0;height:100%;overflow:hidden;font-family:sans-serif;background:#f7f7f7;}
    #top-bar{padding:5px;background:#eee;display:flex;flex-wrap:wrap;gap:4px;align-items:center;}
    #viewer{height:calc(100% - 70px);background:#fff;overflow:auto;}
    #status{height:20px;padding:4px;font-size:12px;background:#fffae6;}
    .highlight{background-color:yellow;}
    .dark-mode{background:#121212;color:#eaeaea;}
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div id="top-bar"&gt;
  &lt;input type="file" id="upload" accept=".epub"&gt;
  &lt;select id="chapters"&gt;&lt;option&gt;è¯·é€‰æ‹©ç« èŠ‚&lt;/option&gt;&lt;/select&gt;
  &lt;button id="prev"&gt;â¬…ï¸ä¸Šä¸€é¡µ&lt;/button&gt;
  &lt;button id="next"&gt;â¡ï¸ä¸‹ä¸€é¡µ&lt;/button&gt;
  &lt;button id="nextChapter"&gt;â©ä¸‹ä¸€ç« &lt;/button&gt;
  &lt;select id="fontSelect"&gt;
    &lt;option value="Microsoft YaHei Light"&gt;å¾®è½¯é›…é»‘ Light&lt;/option&gt;
    &lt;option value="serif"&gt;Serif&lt;/option&gt;
    &lt;option value="sans-serif"&gt;Sans-serif&lt;/option&gt;
  &lt;/select&gt;
  &lt;button id="increaseFont"&gt;ğŸ”¼å¢å­—å·&lt;/button&gt;
  &lt;button id="decreaseFont"&gt;ğŸ”½å‡å­—å·&lt;/button&gt;
  &lt;button id="toggleNight"&gt;ğŸŒ™å¤œé—´æ¨¡å¼&lt;/button&gt;
  &lt;input type="file" id="dictUpload" accept=".txt,.xlsx"&gt;
  &lt;select id="colorSelect"&gt;&lt;option value="yellow"&gt;é»„è‰²&lt;/option&gt;&lt;option value="pink"&gt;ç²‰è‰²&lt;/option&gt;&lt;/select&gt;
  &lt;label&gt;&lt;input type="checkbox" id="caseSensitive"&gt;å¤§å°å†™æ•æ„Ÿ&lt;/label&gt;
&lt;/div&gt;
&lt;div id="viewer"&gt;&lt;/div&gt;
&lt;div id="status"&gt;ğŸ“–ç­‰å¾…ä¸Šä¼ EPUB...&lt;/div&gt;

&lt;script&gt;
let book,rendition,highlights=new Set(),isDark=false,fontSize=100,highlightColor='yellow',caseSensitive=false;

upload.onchange=function(){
  book=ePub(this.files[0]);
  rendition=book.renderTo("viewer",{flow:"scrolled-doc",width:"100%",height:"100%"});
  rendition.display();
  book.loaded.navigation.then(nav=&gt;{
    chapters.innerHTML=nav.toc.map(c=&gt;`&lt;option value="${c.href}"&gt;${c.label}&lt;/option&gt;`).join('');
  });
  rendition.on("rendered",()=&gt;{
    applyTheme();
    applyHighlights();
  });
};

function applyTheme(){
  rendition.themes.register("custom",{body:{"font-family":fontSelect.value,"font-size":fontSize+"%",color:isDark?"#eee":"#000",background:isDark?"#121212":"#fff"}});
  rendition.themes.select("custom");
}

function applyHighlights(){
  rendition.getContents().forEach(c=&gt;{
    highlights.forEach(word=&gt;{
      const reg=new RegExp(`\b(${word})\b`,caseSensitive?"g":"gi");
      c.document.body.innerHTML=c.document.body.innerHTML.replace(reg,`&lt;mark class="highlight" style="background-color:${highlightColor}"&gt;$1&lt;/mark&gt;`);
    });
  });
}

chapters.onchange=()=&gt;rendition.display(chapters.value);
prev.onclick=()=&gt;rendition.prev();
next.onclick=()=&gt;rendition.next();

nextChapter.onclick=()=&gt;{
  let spine=book.spine.spineItems,idx=spine.findIndex(i=&gt;i.href==rendition.location.start.href);
  if(idx&lt;spine.length-1)rendition.display(spine[idx+1].href);else alert('å·²æ˜¯æœ€åä¸€ç« ');
};

increaseFont.onclick=()=&gt;{fontSize+=10;applyTheme();};
decreaseFont.onclick=()=&gt;{fontSize-=10;applyTheme();};
fontSelect.onchange=applyTheme;
toggleNight.onclick=()=&gt;{isDark=!isDark;applyTheme();};
colorSelect.onchange=()=&gt;{highlightColor=colorSelect.value;applyHighlights();};
caseSensitive.onclick=()=&gt;{caseSensitive=caseSensitive.checked;applyHighlights();};

dictUpload.onchange=async()=&gt;{
  highlights.clear();let f=this.files[0];
  if(f.name.endsWith('.txt'))(await f.text()).split(/
?
/).map(l=&gt;highlights.add(l.trim()));
  else if(f.name.endsWith('.xlsx'))XLSX.utils.sheet_to_json(XLSX.read(await f.arrayBuffer()).Sheets.Sheet1,{header:1}).map(r=&gt;highlights.add(r[0].trim()));
  status.textContent=`âœ…å·²åŠ è½½è¯è¡¨:${highlights.size}ä¸ª`;applyHighlights();
};
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
